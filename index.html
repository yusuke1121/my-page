<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>My ChatGPT MultiTool 完全統合版</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; margin-bottom: 10px; }
    .message { margin: 5px 0; }
    .user { color: blue; }
    .ai { color: green; }
    .toolbar button { margin: 5px; padding: 5px 10px; }
    .template { margin-top: 10px; }
  </style>
</head>
<body>

<h1>My ChatGPT MultiTool 完全統合版</h1>

<div id="chat"></div>

<div class="toolbar">
  <button onclick="insertTemplate('おはようございます')">🌅</button>
  <button onclick="insertTemplate('ありがとうございます')">🙏</button>
  <button onclick="insertTemplate('今日の予定は？')">📅</button>
  <button onclick="insertTemplate('英訳して')">🇺🇸</button>
  <button onclick="insertTemplate('要約して')">📝</button>
  <button onclick="insertTemplate('コードレビューして')">💻</button>
  <button onclick="insertTemplate('プラン提案して')">🎯</button>
</div>

<input type="text" id="userInput" placeholder="メッセージを入力" style="width: 80%;">
<button onclick="sendMessage()">送信</button>

<div class="template">
  <input type="text" id="templateName" placeholder="テンプレ名">
  <input type="text" id="templateContent" placeholder="テンプレ内容">
  <button onclick="saveTemplate()">＋保存</button>
  <button onclick="deleteAllTemplates()">全削除</button>
</div>

<div id="templateList"></div>

<script>
// API通信部分
const apiEndpoint = "https://wispy-sea-a162.ushishibaku.workers.dev/";
const model = "gpt-4o";

async function sendMessage() {
  const input = document.getElementById("userInput");
  const message = input.value;
  if (!message) return;

  appendMessage("user", message);
  input.value = "";

  try {
    const response = await fetch(apiEndpoint, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: model,
        messages: [{ role: "user", content: message }]
      })
    });

    if (!response.ok) {
      appendMessage("ai", "エラー発生: " + response.status);
      return;
    }

    const data = await response.json();
    const aiReply = data.choices[0].message.content;
    appendMessage("ai", aiReply.replace(/\n/g, "<br>"));
  } catch (error) {
    appendMessage("ai", "通信エラー: " + error);
  }
}

function appendMessage(role, text) {
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "message " + role;
  div.innerHTML = (role === "user" ? "あなた: " : "AI: ") + text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function insertTemplate(text) {
  document.getElementById("userInput").value = text;
}

// テンプレ保存系
function saveTemplate() {
  const name = document.getElementById("templateName").value;
  const content = document.getElementById("templateContent").value;

  if (!name || !content) {
    alert("テンプレ名と内容を入力してください");
    return;
  }

  const templates = JSON.parse(localStorage.getItem("templates") || "{}");
  templates[name] = content;
  localStorage.setItem("templates", JSON.stringify(templates));

  renderTemplates();
}

function renderTemplates() {
  const templates = JSON.parse(localStorage.getItem("templates") || "{}");
  const list = document.getElementById("templateList");
  list.innerHTML = "";

  for (const name in templates) {
    const btn = document.createElement("button");
    btn.textContent = name;
    btn.onclick = () => insertTemplate(templates[name]);
    list.appendChild(btn);
  }
}

function deleteAllTemplates() {
  if (confirm("全テンプレを削除しますか？")) {
    localStorage.removeItem("templates");
    renderTemplates();
  }
}

window.onload = renderTemplates;
</script>

</body>
</html>
